<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>Grumman</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="style/animate.css" />
    <link rel="stylesheet" href="style/bootstrap.min.css">
	<link rel="stylesheet" href="style/main.css">
	<link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/ng-modal.css">
	<link rel="stylesheet" href="style/angular-material.min.css"> 
	 
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript" src="https://www.google.com/uds/?file=visualization&amp;v=1&amp;hl=fr&amp;packages=corechart&amp;async=2"></script>
	<link type="text/css" href="https://www.google.com/uds/api/visualization/1.0/ff67c3772da186a412ae3231c32409e9/ui+fr.css" rel="stylesheet">
	<script type="text/javascript" src="https://www.google.com/uds/api/visualization/1.0/ff67c3772da186a412ae3231c32409e9/format+fr,default+fr,ui+fr,corechart+fr.I.js"></script>
	<link href="https://ajax.googleapis.com/ajax/static/modules/gviz/1.0/core/tooltip.css" rel="stylesheet" type="text/css">
		
<style>
.Loading {
    display: inline-block;
    vertical-align: middle;
    background-position: center;
    background:no-repeat;
    background-image: url('data:image/gif;base64,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');
    width:20px;
    height:20px;
    margin-top:6px;
    margin-right:7px;
}
.AutocompleteDropDown {
	background-color: #fcf8e3;
	}
</style>

		
</head>
<body ng-app="grummanmonitor">
<!-- Show the directory currently used - remove it on a production server to not display the internal disk structure -->
<!--  Page Directory: @_PAGEDIRECTORY_@ -->



<div class="container-fluid" id="accordion">
	<div class="row">
		<div class="component col-xs-12"  ng-controller="GrummanControler as ctrl">
			<center>
		<table><tr><td><h1>Grumman</h1></td><td rowspan="2"><img src="img/grumman.jpg" width="150" heigth="150" /></td></tr>
			<tr><td>
				<center>
					Beta 0.11
				</center>
			</td></tr>
		</table>
		</center>
	  
	  	
		<ul class="nav nav-tabs"  ng-class="{'nav-stacked': vertical, 'nav-justified': justified}" style="border-bottom: 1px solid #c2c2c2;">
			<li ng-class="{active: active, disabled: false}" id="form-tab" heading="All" active="true" title="Synthese" select="ctrl.navbaractiv == 'synthesis'" class="{{ctrl.getNavClass('synthesis')}}" style="{{ctrl.getNavStyle('synthesis')}}">
				  <a ng-click="ctrl.navbaractiv = 'synthesis';"   class="ng-binding">Synthesis</a>
			</li>
			<li ng-class="{active: active, disabled: false}" id="form-tab" heading="Groovy Code" active="true" title="Check reconciliation messages" select="ctrl.navbaractiv == 'reconciliationmsg'" class="{{ctrl.getNavClass('reconciliationmsg')}}" style="{{ctrl.getNavStyle('reconciliationmsg')}}">
				  <a  ng-click="ctrl.navbaractiv='reconciliationmsg'"  class="ng-binding">Reconciliation Messages</a>
			</li>
			<li ng-class="{active: active, disabled: false}" id="form-tab" heading="Purge Message table" active="true" title="Purge Message table" select="ctrl.navbaractiv == 'purgemessagetables'" class="{{ctrl.getNavClass('purgemessagetables')}}" style="{{ctrl.getNavStyle('purgemessagetables')}}">
				  <a  ng-click="ctrl.navbaractiv='purgemessagetables'" class="ng-binding">Purge message tables</a>
			</li>

			<li ng-class="{active: active, disabled: false}" id="form-tab" heading="DuplicateMessage" active="true" title="Duplicate message" select="ctrl.navbaractiv == 'duplicatemsg'" class="{{ctrl.getNavClass('duplicatemsg')}}" style="{{ctrl.getNavStyle('duplicatemsg')}}">
				  <a  ng-click="ctrl.navbaractiv='duplicatemsg'" class="ng-binding">Duplicate Messages</a>
			</li>
<!-- 
	 
			<li ng-class="{active: active, disabled: false}" id="form-tab" heading="Oldmsg" active="true" title="Old messages" select="ctrl.navbaractiv == 'oldmsg'" class="{{ctrl.getNavClass('oldmsg')}}" style="{{ctrl.getNavStyle('oldmsg')}}">
				  <a  ng-click="ctrl.navbaractiv='oldmsg'" class="ng-binding">Old Messages</a>
			</li>
			
			
			Doublon message based on correlation 1 = caseid
			too old : integrer la date dans la table message
 -->
		</ul>
		
		<!--  ************************************************************  -->	
		<!--  Synthese	 										-->
		<!--  ************************************************************  -->
		<div class="col-lg-12" ng-show="ctrl.navbaractiv == 'synthesis'">
			<p>
			<table><tr>
				<td><div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
				<td><button ng-click="ctrl.getSynthesis()" class="btn btn-info" ng-disabled="ctrl.inprogress">Refresh</button></td>
			</tr></table>
				
			<table class="table table-striped">
				<tr><td>Number of waiting events</td>			<td style="text-align:right">{{ctrl.synthesis.nbwaitingevent}}</td></tr>
				<tr><td>Number of waiting messages</td>			<td style="text-align:right">{{ctrl.synthesis.nbmessageevent}}</td></tr>
				<tr><td>Number of reconciliation messages</td>	<td style="text-align:right">{{ctrl.synthesis.nbreconciliation}}</td></tr>
			</table>
			<div>Result in {{ctrl.synthesis.performancemesure.total.time}} ms</div>
		
			<div ng-bind-html="ctrl.getListEvents( ctrl.synthesis.listevents )"></div>
			
		</div>					
	  
	  	<!--  ************************************************************  -->	
		<!--  Reconciliation Messages	 										-->
		<!--  ************************************************************  -->
		<div class="col-lg-12" ng-show="ctrl.navbaractiv == 'reconciliationmsg'">
			<p>
			<table>
				<tr><td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<table><tr>
						<td>Maximum detection messages: <input ng-model="ctrl.reconciliationmsg.numberofmessages" type="number">&nbsp;&nbsp;</td>
						<td><div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
						<td><button ng-click="ctrl.getIncompleteReconciliationMessage()" class="btn btn-info" ng-disabled="ctrl.inprogress">Collect reconciliation messages</button>
						</td>	
					</tr></table>
					<div ng-if="! ctrl.showHelpReconciliation"><a ng-click="ctrl.showHelpReconciliation = ! ctrl.showHelpReconciliation"  class="ng-binding" title="Help on reconcialition"><span class="glyphicon glyphicon-question-sign"></span></a></div>
					
					<div class="well" ng-if="ctrl.showHelpReconciliation">
						<a ng-click="ctrl.showHelpReconciliation = ! ctrl.showHelpReconciliation"  class="ng-binding"><span class="glyphicon glyphicon-question-sign"></span></a>
						A reconciliation message means a event is waiting, message (for this correlation key) was sent but the message does not contains all informations.<br>
						Messages status:
						<li>Incomplete Content: In the design, message expect content (variable A, B, C). Sender didn't send all required variables.Page can resend a complete content, setting to null all missing content.</li>
						<li>Failed design: something is wrong in the process definition, and the event can't be retrieved. Check the details</li>
						<li>Complete: message was complete, but the execution failed (an operation not correct). Page can resend the message.</li>
						SQL Request used:<br>
						<div style="font-style: italic;">
select distinct  m.locked, w.locked, m.handled, w.active, w.progress, <br>   
w.eventtype as w_eventtype, m.id as m_id, w.id as w_id, fi.lastupdatedate as w_lastupdatedate, <br> 
w.rootprocessinstanceid as w_rootprocessintance, w.messagename as w_messagename, w.flownodename as w_flownodename, w.processname as w_processname, <br> 
 w.processdefinitionid as w_processdefinitionid, w.locked as w_locked, w.active as w_active, w.progress as w_progress, pdroot.name as w_rootprocessname, <br> 
 pdroot.version as w_rootversion, pdroot.processid as w_rootprocessdefinitionid, pdmessage.name as w_messageprocessname, pdmessage.version as w_messageversion, <br> 
 pdmessage.processid as w_messageprocessdefinitionid,  <br>
 w.CORRELATION1 as w_correlation1, w.CORRELATION2 as w_correlation2, w.CORRELATION3 as w_correlation3, w.CORRELATION4 as w_correlation4, w.CORRELATION5 as w_correlation5, m.locked as m_locked, <br> 
m.handled as m_handled  <br>
from waiting_event w <br> 
left join flownode_instance fi on (w.flownodeinstanceid = fi.id) <br>
left join process_instance piroot on (piroot.id = w.rootprocessinstanceid) <br> 
left join process_definition pdroot on (piroot.processdefinitionid = pdroot.processid) <br> 
left join process_instance pimessage on (pimessage.id = w.parentprocessinstanceid) <br> 
left join process_definition pdmessage on (w.processdefinitionid = pdmessage.processid), <br> 
message_instance m  <br>
where m.locked = 0 <br> 
  AND w.locked = 0 and w.active = 1 -- AND w.progress = 0 <br>
  and w.processname = m.targetprocess and w.flownodename = m.targetflownode <br> 
  and w.eventtype != 'START_EVENT' <br>
  and w.CORRELATION1 = m.CORRELATION1 and w.CORRELATION2 = m.CORRELATION2 and w.CORRELATION3 = m.CORRELATION3 and w.CORRELATION4 = m.CORRELATION4 and w.CORRELATION5 = m.CORRELATION5 <br> 
order by m.id, w.id, w_lastupdatedate; <br>
						</div>
					</div>
				</td>
				<td style="vertical-align: top">
					<div class="panel panel-info">
						<div class="panel-heading">Informations</div>
						<div>
						<table class="table table-striped">
							<tr><td>Reconciliation messages</td>				<td style="text-align:right">{{ctrl.reconciliationmsg.detection.nbReconciliations}}</td></tr>
							<tr><td>Complete messages</td>						<td style="text-align:right">{{ctrl.reconciliationmsg.detection.nbCompleteMessages}}</td></tr>
							<tr><td>Incomplete messages</td>					<td style="text-align:right">{{ctrl.reconciliationmsg.detection.nbIncompleteMessages}}</td></tr>
							<tr><td>Number of processes/version/flownodes</td>	<td style="text-align:right">{{ctrl.reconciliationmsg.detection.nbGroups}}</td></tr>
							
						</table>
						</div>
					</div>
				</td>
				</tr>												
			</table>
			
			<div ng-bind-html="ctrl.getListEvents( ctrl.reconciliationmsg.listevents )"></div><p>
			<div>Result in {{ctrl.reconciliationmsg.detection.performancemesure.total.time}} ms</div>
			
			<h1>Reconciliation Messages</h1>
			
			<!--  HEADER -->
			<table width="100%"><tr>
				<td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<button ng-click="ctrl.selectMessage( 'all', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select all</button>&nbsp;
			    	<button ng-click="ctrl.selectMessage( 'incomplete', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select incomplete messages</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'complete', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select complete messages</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'none', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Unselect all</button>&nbsp;
					<a ng-click="ctrl.exportReconciliationData()" title="Click to export to Excel file"><img src="img/docexcel.gif" /></a></td>
			
				<td style="padding: 0px 30px 10px 10px;vertical-align: top;text-align:right">
					<button ng-click="ctrl.showDetailMessage( 'show', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Show All details</button>&nbsp;
					<button ng-click="ctrl.showDetailReconciliationMessage( 'hide' )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Hide All details</button></td>
			</tr></table>
			
			<!--  DATA -->
			<table class="table table-striped">
				<tr><th></th><th>Status</th><th>Process Name</th><th>Version</th><th>Flow node Name</th><th>Type</th><th>Nb reconciliation messages in error</th></tr>
				<tbody ng-repeat="message in ctrl.reconciliationmsg.detection.listmessages">
				<tr>
					<td style="{{ctrl.getReconciliationBackground( message )}}">
						<input ng-model="message.selected" type="checkbox">
					</td>
					<td style="{{ctrl.getReconciliationBackground( message )}}">{{message.status}} {{message.statusexec}}</td>					
					<td style="{{ctrl.getReconciliationBackground( message )}}">{{message.processname}}</td>
					<td style="{{ctrl.getReconciliationBackground( message )}}">{{message.processversion}}</td>
					<td style="{{ctrl.getReconciliationBackground( message )}}">{{message.flowname}}</td>
					<td style="{{ctrl.getReconciliationBackground( message )}}">{{message.catcheventtype}}</td>
					<td style="{{ctrl.getReconciliationBackground( message )}};text-align:right">{{message.numberofmessages}}</td>
					<td style="{{ctrl.getReconciliationBackground( message )}}"><select ng-model="message.showdetail">
						<option value="show">Show detail</option>
						<option value="hide">Hide detail</option>
						</select>
					</td>
					
				</tr>
				<tr ng-if="message.showdetail=='show'"><td></td><td colspan="7">
					<table class="table table-bordered" width="100%">			
						<tr><th>CaseId</th><th>Message name</th><th>Waiting ID</th><th>Message ID</th>
							<th>Nb Waiting events</th>
							<th>Nb Messages</th>
							<th>Correlations</th><th>Expl.</th><th>Status</th>
						</tr>
						<tr ng-repeat="detail in message.details">
							<td style="text-align:right">{{detail.caseid}}</td>
		                    <td >{{detail.messagename}}</td>
		                    <td style="text-align:right">{{detail.wid}}</td> 
		                    <td style="text-align:right">{{detail.mid}}</td>
		                    <td style="text-align:right">{{detail.signaturenbwaitingevent}}</td>
		                    <td style="text-align:right">{{detail.signaturenbmessageinstance}}</td>
		                    <td >{{detail.correlationvalues}}</td>		                    
		                    <td >{{detail.expl}}
		                    	<div ng-if="detail.explexec.length>0" style="font-style: italic;font-weight: bold;">
		                    		<br>Execution:
		                    			{{detail.explexec}}
		                    	</div>
		                    </td>
		                    <td >
		                    
		                    	<div ng-if="detail.statusexec != ''"><span class="{{ctrl.getDetailBackground( detail )}}">
		                    	  {{detail.statusexec}}&nbsp;{{detail.nbexecutioninprogress}}&nbsp;msg
							</span></div>
							
							
							</td>

						</tr>
					</table>
          		</td></tr>
				</tbody>
			</table>
			
			<!-- COMMENT -->
			<table width="100%"><tr>
				<td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<button ng-click="ctrl.selectMessage( 'all', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select all</button>&nbsp;
			    	<button ng-click="ctrl.selectMessage( 'incomplete', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select incomplete messages</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'complete', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select complete messages</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'none', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Unselect all</button>&nbsp;
					<a ng-click="ctrl.exportReconciliationData()" title="Click to export to Excel file"><img src="img/docexcel.gif" /></a></td>
			
				<td style="padding: 0px 30px 10px 10px;vertical-align: top;text-align:right">
					<button ng-click="ctrl.showDetailMessage( 'show', ctrl.reconciliationmsg.detection.listmessages )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Show All details</button>&nbsp;
					<button ng-click="ctrl.showDetailReconciliationMessage( 'hide' )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Hide All details</button></td>
			</tr></table>
		
			<p>
			<table>
				<tr>
					<td colspan="2">
						<input ng-model="ctrl.reconciliationmsg.purgeAllRelatives" type="checkbox" title="Multiple incomplete messages may be send to match the event. By default, the page purge the same number of message_event than the number of event waiting. Click ALL means all message_instance with the same process/target/correlation is purge too">Purge ALL relatives message_instance (same target/flownode/correlations)<br>
						<input ng-model="ctrl.reconciliationmsg.sendincomplete" type="checkbox" title="For each incomplete message, a new complete message is send, and the message_instance is purged">Send Incomplete Messages<br>
						<input ng-model="ctrl.reconciliationmsg.executecomplete" type="checkbox" title="For each INTERMEDIATE complete message, execution is force. Operations are verified, and variables are updated as much as possible">Execute Complete Message
					</td>
				</tr><tr>
					<td>
						<div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
					<td><button ng-click="ctrl.sendIncompleteReconciliationMessage()" class="btn btn-warning" ng-disabled="ctrl.inprogress">Send messages</button></td>
				</tr>
			</table>
			<p>
			<div class="progress">			
				<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ctrl.sendPost.percent}}" aria-valuemin="0" aria-valuemax="100" 
								style="width: {{ctrl.sendPost.percent}}%;"><span class="sr-only">({{ctrl.sendPost.percent}}%)</span></div>
			</div>
			
			<h1>Corrections result</h1>
			
			<div ng-show="ctrl.reconciliationmsg.showresult">
				<table class="table table-stripped">
					<tr><td>Messages sent : 
							<select ng-model="ctrl.reconciliationmsg.showdetailexecution">
								<option value="show">Show detail</option>
								<option value="hide">Hide detail</option>
							</select>
						</td>						<td style="text-align:right">{{ctrl.reconciliationmsg.execution.messagescorrects}}</td></tr>
					<tr><td>Messages in error:</td>	<td style="text-align:right">{{ctrl.reconciliationmsg.execution.messageserrors}}</td></tr>
					<tr><td>Rows Message Data deleted:</td><td style="text-align:right">{{ctrl.reconciliationmsg.execution.nbdatasrowdeleted}}</td></tr>
					<tr><td>Rows Message Instance deleted:</td><td style="text-align:right">{{ctrl.reconciliationmsg.execution.nbmessagesrowdeleted}}</td></tr>
					<tr><td colspan="2"> <div ng-bind-html="ctrl.getListEvents( ctrl.reconciliationmsg.execution.listevents )"></div></td></tr>
					<tr ng-if="ctrl.reconciliationmsg.showdetailexecution">
						<td colspan="2"> 
							<table class="table table-bordered">
								<tr><th>CaseId</th><th>Message name</th><th>Waiting ID</th><th>Message ID</th><th>Expl.</th><th>Status</th></tr>
								<tbody ng-repeat="detail in ctrl.reconciliationmsg.execution.details"> 
									<tr >
										<td style="text-align:right">{{detail.caseid}}</td>
					                    <td>{{detail.messagename}}</td>
					                    <td style="text-align:right">{{detail.wid}}</td> 
					                    <td style="text-align:right">{{detail.mid}}</td>
					                    <td>{{detail.expl}}</td>
					                    <td><div class="{{ctrl.getDetailBackground( detail )}}">{{detail.statusexec}}&nbsp;{{detail.nbexecutioninprogress}}&nbsp;msg</div></td>
									</tr>
									<tr>
										<td colspan="4"></td>
										<td colspan="2"><div style="font-style: italic;font-weight: bold;">{{detail.explexec}}</div><br>
										
										Message ID purged: {{detail.listmessageinstancerelativepurged}}</td>
									</tr>
								</tbody>
							</table>
						</td>					
					</tr>
				</table>
			</div>
			
		</div>
									
	  	<!--  ************************************************************  -->	
		<!--  Purge message table										-->
		<!--  ************************************************************  -->
		<div class="col-lg-12" ng-show="ctrl.navbaractiv == 'purgemessagetables'">
			<p>
			<table><tr>
				<td><div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
				<td><button ng-click="ctrl.getPurgeTablesMonitoringItems()" class="btn btn-info" ng-disabled="ctrl.inprogress">Get information</button>
			</tr></table>
		
		
			
			 <div ng-bind-html="ctrl.getListEvents( ctrl.purgetablesmonitoring.monitoring.listevents )"></div>

				
			<table class="table table-striped">
				<tr><th>label</th><th>Nb Records</th><th>Nb Records purged</th><th>Explanations</th></tr>
				<tbody ng-repeat="item in ctrl.purgetablesmonitoring.monitoring.listitems">
				<tr>
					<td>{{item.label}}</td>
					<td>{{item.nbrecords}}</td>
					<td>{{item.nbrecordspurged}}</td>
					<td>{{item.explanation}}</td>
				</tr>
				<tr>
					<td></td>
					<td colspan="3" style="font-size: small;font-style: italic;"><i>{{item.querydeletion}}</i></td>
				</tr>
				</tbody>
			</table>
			
			
			<table><tr>
				<td><div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
				<td><button ng-click="ctrl.executepurgetablesmonitoring()" class="btn btn-warning" ng-disabled="ctrl.inprogress">Purge</button>
			</tr></table>
			
			
			
			 <div ng-bind-html="ctrl.getListEvents( ctrl.purgetablesmonitoring.result.listevents )"></div>
		</div>					
	 				
	  	<!--  ************************************************************  -->	
		<!--  Duplicate	 Messages										-->
		<!--  ************************************************************  -->
		<div class="col-lg-12" ng-show="ctrl.navbaractiv == 'duplicatemsg'">
			
			<p>
			<table>
				<tr><td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<table><tr>
						<td>Maximum detection messages: <input ng-model="ctrl.duplicationmsg.maximumnumberofduplications" type="number">&nbsp;&nbsp;</td>
						<td><div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
						<td><button ng-click="ctrl.getListDuplicateMessages()" class="btn btn-info" ng-disabled="ctrl.inprogress">Collect duplicate messages</button></td>	
					</tr></table>
					<div ng-if="! ctrl.showHelpDuplication"><a ng-click="ctrl.showHelpDuplication = ! ctrl.showHelpDuplication"  class="ng-binding" title="Help on reconcialition"><span class="glyphicon glyphicon-question-sign"></span></a></div>
					
					<div class="well" ng-if="ctrl.showHelpDuplication">
						<a ng-click="ctrl.showHelpDuplication = ! ctrl.showHelpDuplication"  class="ng-binding"><span class="glyphicon glyphicon-question-sign"></span></a>
						Multiple duplicate messages can be detected:
						<li>Same process / target flow node</li>
						<li>Same correlations key</li>
						ATTENTION: it's maybe a normal situation. In BPMN, message must fit one case, and the business case can send multiple identical messages to unlock multiple cases with the same correlation.
						SQLRequest:<br>
						<div style="font-style: italic;">
						 SELECT a.id, b.id as duplicate_id, a.*<br> 
            from message_instance a, message_instance b <br>
            where a.id < b.id <br>
            and a.id = (select min(c.id) from message_instance c<br> 
            where c.targetprocess = a.targetprocess<br>
            and c.targetflownode = a.targetflownode<br>
            and c.CORRELATION1 = a.CORRELATION1<br>
            and c.CORRELATION2 = a.CORRELATION2<br>
            and c.CORRELATION3 = a.CORRELATION3<br>
            and c.CORRELATION4 = a.CORRELATION4<br>
            and c.CORRELATION5 = a.CORRELATION5)<br>
            and a.targetprocess = b.targetprocess <br>
            and a.targetflownode = b.targetflownode <br>
            and (a.CORRELATION1 != 'NONE' or a.CORRELATION2 != 'NONE' or a.CORRELATION3 != 'NONE' or a.CORRELATION4 != 'NONE' or a.CORRELATION5 != 'NONE')<br>
            and a.CORRELATION1 = b.CORRELATION1 <br>
            and a.CORRELATION2 = b.CORRELATION2 <br>
            and a.CORRELATION3 = b.CORRELATION3 <br>
            and a.CORRELATION4 = b.CORRELATION4 <br>
            and a.CORRELATION5 = b.CORRELATION5 <br>
            order by a.id, b.id<br>
            			</div>
					</div>
				</td>
				</tr>
			</table>
			
			<div ng-bind-html="ctrl.getListEvents( ctrl.duplicationmsg.listevents )"></div><p>
			<div>Result in {{ctrl.duplicationmsg.detection.performancemesure.total.time}} ms</div>
			
			<h1>Duplications</h1>
		
		
			<!--  HEADER -->
			<table width="100%"><tr>
				<td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<button ng-click="ctrl.selectMessage( 'all', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select all</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'none', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Unselect all</button>&nbsp;
					<a ng-click="ctrl.exportDuplicateData()" title="Click to export to Excel file"><img src="img/docexcel.gif" /></a>
			
				<td style="padding: 0px 30px 10px 10px;vertical-align: top;text-align:right">
					<button ng-click="ctrl.showDetailMessage( 'show', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Show All details</button>&nbsp;
					<button ng-click="ctrl.showDetailMessage( 'hide', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Hide All details</button>&nbsp;
				</td>
			</tr></table>
		
			<!--  DATA -->		
			<table class="table table-striped">
				<tr><th></th><th>Status</th><th>Process Name</th><th>Flow node Name</th><th>Message name</th><th>number of duplications</th><th>Correlations</th></tr>
				<tbody ng-repeat="message in ctrl.duplicationmsg.detection.listduplications">
				<tr>
					<td><input ng-model="message.selected" type="checkbox"></td>
					<td >{{message.statusexec}}</td>
					<td >{{message.targetprocess}}</td>					
					<td >{{message.targetflownode}}</td>					
					<td >{{message.messagename}}</td>					
					<td >{{message.nbduplications}}</td>			
					<td >{{message.correlationvalues}}</td>	
					<td ><select ng-model="message.showdetail">
						<option value="show">Show detail</option>
						<option value="hide">Hide detail</option>
						</select>
					</td>		
				</tr>
				<tr ng-if="message.showdetail == 'show'">
					<td></td>
					<td colspan="5"> 
							<table class="table table-bordered">
								<tr><th>WorkingId</th><th>Status</th></tr>
								<tr><td style="background-color:#ecf0f1">{{message.originalid}}</td>
									<td style="background-color:#ecf0f1"></td>
								</tr>
								<tr ng-repeat="detail in message.messagesduplicated">
									<td>{{detail.mid}}</td>
									<td><span class="{{ctrl.getDetailBackground( detail )}}">{{detail.statusexec}}</span></td>
								</tr>
							</table>
					</td>
				</tr>
					
				</tbody>
			</table>
			
			<table width="100%"><tr>
				<td style="padding: 0px 30px 10px 10px;vertical-align: top">
					<button ng-click="ctrl.selectMessage( 'all', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Select all</button>&nbsp;
					<button ng-click="ctrl.selectMessage( 'none', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Unselect all</button>&nbsp;
					<a ng-click="ctrl.exportDuplicateData()" title="Click to export to Excel file"><img src="img/docexcel.gif" /></a>
			
				<td style="padding: 0px 30px 10px 10px;vertical-align: top;text-align:right">
					<button ng-click="ctrl.showDetailMessage( 'show', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Show All details</button>&nbsp;
					<button ng-click="ctrl.showDetailMessage( 'hide', ctrl.duplicationmsg.detection.listduplications )" class="btn btn-primary btn-xs" ng-disabled="ctrl.inprogress">Hide All details</button>&nbsp;
				</td>
			</tr></table>
		
		
			<p>
			<table>
				<tr>
					<td>
						<div ng-show="ctrl.inprogress"><span class="Loading">.</span></div></td>	
					<td><button ng-click="ctrl.deleteDuplicateMessages()" class="btn btn-warning" ng-disabled="ctrl.inprogress">Delete Duplicate Messages</button></td>
				</tr>
			</table>
			<p>
			<div class="progress">			
				<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ctrl.sendPost.percent}}" aria-valuemin="0" aria-valuemax="100" 
								style="width: {{ctrl.sendPost.percent}}%;"><span class="sr-only">({{ctrl.sendPost.percent}}%)</span></div>
			</div>
			
			<h1>Deletion result</h1>
			
			<div ng-show="ctrl.duplicationmsg.showresult">
				<table class="table table-stripped">
					<tr><td>Deletion sent : 
							<select ng-model="ctrl.duplicationmsg.showdetailexecution">
								<option value="show">Show detail</option>
								<option value="hide">Hide detail</option>
							</select>
						</td></tr>
					<tr><td>Rows Message Data deleted:</td><td style="text-align:right">{{ctrl.duplicationmsg.execution.nbdatasrowdeleted}}</td></tr>
					<tr><td>Rows Message Instance deleted:</td><td style="text-align:right">{{ctrl.duplicationmsg.execution.nbmessagesrowdeleted}}</td></tr>
					<tr><td colspan="2"> <div ng-bind-html="ctrl.getListEvents( ctrl.duplicationmsg.execution.listevents )"></div></td></tr>
					<tr ng-if="ctrl.duplicationmsg.showdetailexecution === 'show'">
						<td colspan="2"> 
							<table class="table table-bordered" style="width: 150px;">
								<tr><th>Message Id</th></tr>
								<tbody ng-repeat="detail in ctrl.duplicationmsg.execution.listmessageinstancepurged"> 
								<tr >
				                    <td style="text-align:right">{{detail}}</td>
								</tr>
								</tbody>
							</table>
					</td>
					
				</tr>
				</table>
			</div>
		
		
		</div>					
	  		<!--  ************************************************************  -->	
		<!--  Old Message	 										-->
		<!--  ************************************************************  -->
		<div class="col-lg-12" ng-show="ctrl.navbaractiv == 'oldmsg'">
			<div ng-show="ctrl.inprogress"><span class="Loading">.</span></div>		
			<button ng-click="ctrl.refresh( false )" class="btn btn-info btn-xs" ng-disabled="ctrl.inprogress">Refresh</button>	
		</div>					
	  
	  	</div> <!--  end controler -->
	</div>
</div>



<!-- Third party dependencies -->

<script src="3rd-party/jquery.min.js"></script>

<script src="3rd-party/angular.min.js"></script>

<script src="3rd-party/angular-resource.min.js"></script>
<script src="3rd-party/angular-cookies.min.js"></script>

<script src="3rd-party/bootstrap/js/bootstrap.min.js"></script>
<script src="3rd-party/angular-bootstrap-tpls.min.js"></script>
<script src="3rd-party/angular-file-upload.js"></script> 
<script src="3rd-party/ng-google-chart.js"></script> 
<script src="3rd-party/angular-sanitize.min.js"></script> 
<script src="3rd-party/ng-modal.min.js"></script> 

<!--  Material -->  
<script src="3rd-party/angular-animate.min.js"></script>  
<script src="3rd-party/angular-aria.min.js"></script>  
<script src="3rd-party/angular-messages.min.js"></script>  
<script src="3rd-party/angular-material.min.js"></script>  





  

<!-- Application dependencies -->
<!-- to be sure to reload every time the JS file, add this marker -->
<!--  <script src="pageResource?page=custompage_grumman&location=grummanmonitor.js&t=@_CURRENTTIMEMILIS_@"></script> -->
<script src="grummanmonitor.js?&t=@_CURRENTTIMEMILIS_@"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/alasql/0.3/alasql.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.3/xlsx.full.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.3/xlsx.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.3/xlsx.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.3/xlsx.core.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.3/cpexcel.js"></script>


</body>
</html>		